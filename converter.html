
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://rawgithub.com/nodeca/pako/master/dist/pako.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
<script type="text/javascript">



var spreadsheet_id = gup('spreadsheet_id');
var sheet_id = gup('sheet_id');

var public_html_url = 'https://docs.google.com/spreadsheets/d/'+ spreadsheet_id +'/pubhtml?gid='+ sheet_id +'&single=true'

    
console.log (public_html_url);
    

function init() {
    Tabletop.init( { key: public_html_url,
                     callback: showInfo,
                     simpleSheet: true } )
}

function showInfo(data, tabletop) {
    alert('Successfully processed!')
    console.log(data);
    var header = Object.keys(data[0]);
    header.splice(header.indexOf('STATUS'), 1);
    header.splice(header.indexOf('FEATUREID'), 1);
    header.splice(header.indexOf('WKTGEOMETRY'), 1);
    header_text = 'WKT,'+header.toString();
    console.log(header_text);
    //document.write(header_text);
    var i, k, rows = data.length, columns = header.length
    for (i=0; i<rows; ++i) {
        row = data[i];
        // Decode base64 (convert ascii to binary)
        var strData     = atob(row.WKTGEOMETRY);
        // Convert binary string to character-number array
        var charData    = strData.split('').map(function(x){return x.charCodeAt(0);});
        // Turn number array into byte-array
        var binData     = new Uint8Array(charData);
        // Pako magic
        var inflated        = pako.inflate(binData);
        // Convert gunzipped byteArray back to ascii string:
        var row_txt     = String.fromCharCode.apply(null, new Uint16Array(data));
        for (k=0; k<columns; ++k) {
            row_txt += row[header[k]];
        }
        console.log(row_txt);
        //document.write(row_txt);
        
    }
}

window.addEventListener('DOMContentLoaded', init)
      

function gup(name) {
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}
    
</script>

</head>

<body>

</body>
</html>
//
